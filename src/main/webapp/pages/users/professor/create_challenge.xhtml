<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composites="http://java.sun.com/jsf/composite/composites">

<f:view locale="#{localeBean.locale}" />

<h:head>
	<title>#{text['label_application_title']}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</h:head>
<h:body>
	<h:outputStylesheet name="css/default.css" />
	<composites:layouts main_menu_mb="#{mainMenuMB}" >
		<p:layoutUnit position="center" header="#{text['label_create_challenge']}" style="text-align:center">
			<h:form id="challenge_form">
				<p:panelGrid id="challenge_pg">
					<p:row>
						<p:column>
							<h:outputLabel for="title" value="#{text['label_title']}" />
						</p:column>
						<p:column style="text-align:left">											
							<p:inputTextarea id="title" rows="1" cols="60"  maxlength="50" 
								value="#{challengeMB.challenge.title}" required="true"
								placeholder="#{text['label_title']}" />							
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<h:outputLabel for="discipline" value="#{text['label_discipline']}" />
						</p:column>
						<p:column style="text-align:left">
							<p:selectOneMenu id="discipline" value="#{challengeMB.challenge.discipline}" converter="disciplineConverter">
								<f:selectItem itemLabel="#{text['label_select']}" itemValue="" />
					            <f:selectItems value="#{challengeMB.loadUserDisciplines()}" var="discipline" itemLabel="#{discipline.name}"
					            	itemValue="#{discipline}" />
					        </p:selectOneMenu>							
						</p:column>	
					</p:row>
					<p:row>
						<p:column colspan="2">
							<p:commandButton id="create_question_btn" ajax="true" value="#{text['label_create_question']}"
								process="@this" actionListener="#{challengeMB.initCurrentQuestion()}" update="j_idt6:question_form"
				        		oncomplete="PF('insertQuestion_wv').show();" icon="fa fa-fw fa-plus-circle" />
						</p:column>
					</p:row>
					<p:row>
						<p:column colspan="2">
							<p:commandButton id="register_challenge_btn" ajax="true" process="challenge_pg" update="@form"
								value="#{text['label_register_challenge']}" actionListener="#{challengeMB.persistChallenge()}" 
								icon="fa fa-fw fa-save" />
						</p:column>
					</p:row>
					<p:row>
						<p:column colspan="2">
							<p:dataTable id="challenge_questions_dt" var="question" value="#{challengeMB.challenge.questions}"
								rowKey="#{question.hashCode()}" selection="#{challengeMB.currentQuestion}"
								selectionMode="single" emptyMessage="#{text['msg_no_records_found']}">
				                 <f:facet name="header">
				            		#{text['label_questions']}
						        </f:facet>
						        <p:column headerText="#{text['label_description']}" >
						            <h:outputText value="#{question.description}" />
						        </p:column>
						    </p:dataTable>					    						   
						</p:column>
					</p:row>									
				</p:panelGrid>
			</h:form>
			
			<h:form id="question_form">
				<p:dialog header="#{text['label_question']}" id="insert_question_dialog" widgetVar="insertQuestion_wv" closeOnEscape="true" closable="true" resizable="false"
					responsive="true" hideEffect="puff" showEffect="puff" height="550" width="700">				
					<p:panelGrid id="question_pg">
						<p:row>
							<p:column colspan="2">
								<h:outputText value="#{text['label_description']}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column colspan="2">
								<p:inputTextarea id="description" rows="7"
									cols="68" maxlength="1000" autoResize="false"
									value="#{challengeMB.currentQuestion.description}"/>
							</p:column>				
						</p:row>						
						<ui:repeat var="letter" value="#{challengeMB.loadAllLetters()}" varStatus="status">
							<p:row>
								<p:column>
									<h:outputText value="#{text['label_letter']} #{letter}" />											
								</p:column>
								<p:column>
									<p:inputTextarea placeholder="#{text['label_description']}" id="description"
									rows="5" cols="60" maxlength="1000" autoResize="false"
									value="#{challengeMB.alternatives.get(status.index).description}" required="true" />												
								</p:column>
							</p:row>										
				        </ui:repeat>
				        <p:row>
							<p:column colspan="2" >
								<h:outputLabel for="pontuation" value="#{text['label_pontuation']}" />
		        				<p:spinner id="pontuation" value="#{challengeMB.currentQuestion.pontuation}"
		        					stepFactor="10" min="0" max="100" size="5" required="true"
									style="margin-right: 10px"/>
    
								<h:outputLabel for="true_alternative" value="#{text['label_true_alternative']}" />
								<p:selectOneMenu id="true_alternative" value="#{challengeMB.trueAlternative}">
									<f:selectItem itemLabel="#{text['label_select']}" itemValue="" />
						            <f:selectItems value="#{challengeMB.loadAllLetters()}" var="letter" itemLabel="#{letter}" 
						            	itemValue="#{letter}" />
						        </p:selectOneMenu>
							</p:column>							
						</p:row>
						<p:row>
							<p:column colspan="2">
								<p:commandButton id="register_btn" ajax="true" process="question_pg" value="#{text['label_register']}"  
									actionListener="#{challengeMB.addQuestionToChallenge()}" validateClient="true"
									update="j_idt6:challenge_form:challenge_questions_dt j_idt6:growl"
									oncomplete="PF('insertQuestion_wv').hide();" icon="fa fa-fw fa-chevron-circle-down"/>								
							</p:column>	
						</p:row>
					</p:panelGrid>
				</p:dialog>	
			</h:form>
		</p:layoutUnit>
	</composites:layouts>
</h:body>
</html>
