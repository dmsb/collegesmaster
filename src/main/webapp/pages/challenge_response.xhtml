<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composites="http://java.sun.com/jsf/composite/composites">

<h:head>
	<title>#{text['label_application_title']}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</h:head>
<h:body>
	<composites:layouts main_mb="#{mainMB}"
		user_session_mb="#{userSessionMB}">
		<p:layoutUnit id="layout_center" position="center" header="#{text['label_disciplines']}" style="text-align:center">
			
			<h:form id="disciplines_form">
				<p:dataTable id="disciplines_data_table" var="discipline" value="#{challengeResolutionMB.userDisciplines}"
					selectionMode="single" selection="#{challengeResolutionMB.selectedDiscipline}" rowKey="#{discipline.id}">							
					
					<p:column headerText="#{text['label_title']}">
						<h:outputText value="#{discipline.name}" />
					</p:column>
					
					<p:column headerText="#{text['label_total_challenges']}">
						<h:outputText value="#{discipline.challenges.size()}" />					
					</p:column>
					
					<p:ajax event="rowSelect" process="@parent"
						update="j_idt5:challenges_form:challenges_data_table" oncomplete="PF('challenges_wv').show()" />					
				</p:dataTable>					
			</h:form>
			
			<h:form id="challenges_form">
				<p:dialog id="challenges_dialog" widgetVar="challenges_wv" closeOnEscape="true" closable="true" resizable="false"
					responsive="true" hideEffect="puff" showEffect="puff" height="500" width="500">
					<p:panelGrid id="challenges_pn">
						<p:row>
							<p:column>
						        <h:outputText value=" #{text['label_challenges']}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:dataTable id="challenges_data_table" var="challenge" value="#{challengeResolutionMB.selectedDiscipline.challenges}"
									selectionMode="single" selection="#{challengeResolutionMB.selectedChallenge}" rowKey="#{challenge.id}">														
									
									<p:column headerText="#{text['label_title']}">
										<h:outputText value="#{challenge.title}" />
									</p:column>
									
									<p:ajax event="rowSelect" process="@parent" listener="#{challengeResolutionMB.loadChallengeQuestions()}"
										update="j_idt5:challenges_form:questions_data_table" oncomplete="PF('questions_wv').show()" />
									
								</p:dataTable>	
							</p:column>
						</p:row>
					</p:panelGrid>										
				</p:dialog>	
				
				<p:dialog id="questions_dialog" widgetVar="questions_wv" closeOnEscape="true" closable="true" resizable="false"
					responsive="true" hideEffect="puff" showEffect="puff" height="500" width="500">
					<p:panelGrid id="questions_pn">
						<p:row>
							<p:column>
						        <h:outputText value="#{challengeResolutionMB.selectedChallenge.title}" rendered="true" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
						        <h:outputText value="#{text['label_questions']}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:dataTable id="questions_data_table" var="question" value="#{challengeResolutionMB.selectedChallenge.questions}"
									selectionMode="single" selection="#{challengeResolutionMB.selectedQuestion}" rowKey="#{question.id}">							
									
									<p:column headerText="#{text['label_description']}">
										<h:outputText value="#{question.description}" />
									</p:column>
									
									<p:ajax event="rowSelect" process="@parent"
										update="j_idt5:challenges_form:questions_data_table" oncomplete="PF('questions_wv').show()" />								
								</p:dataTable>
							</p:column>
						</p:row>
					</p:panelGrid>					
				</p:dialog>
				
				<p:dialog id="responses_dialog" widgetVar="responses_wv" closeOnEscape="true" closable="true" resizable="false"
					responsive="true" hideEffect="puff" showEffect="puff" height="500" width="500">
					<p:panelGrid id="responses_pg">
						<p:row>
							<p:column>
								<h:outputText value="#{challengeResolutionMB.selectedQuestion.description}" />
							</p:column>
						</p:row>						
						<ui:repeat value="#{challengeResolutionMB.selectedQuestion.alternatives}" 
							var="alternative" varStatus="status">
							<p:row>
								<p:column>
									<h:outputText value="#{alternative.letter}" />
								</p:column>
								<p:column>
									<h:outputText value="#{alternative.description}" />
								</p:column>
								<p:column>
									<p:commandButton oncomplete="PF('responses_wv').hide()" process="@parent"
										actionListener="#{ChallengeResolution.selectAlternative(alternative)}"
										update="j_idt5:challenges_form:questions_data_table" />
								</p:column>
							</p:row>
						</ui:repeat>
					</p:panelGrid>
				</p:dialog>		
			</h:form>
		</p:layoutUnit>
	</composites:layouts>
</h:body>
</html>
