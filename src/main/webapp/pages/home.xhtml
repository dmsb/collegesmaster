<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{localeBean.locale}" />

<h:head>
	<title>#{text['label_application_title']}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</h:head>
<h:body>
	
	<h:outputStylesheet name="css/generalStyles.css" />
	
	<p:layout fullPage="true">
		<p:layoutUnit position="north"
			header="#{text['label_application_title']}"
			style="text-align: center;" />

		<p:layoutUnit position="west" header="#{text['label_access']}" size="17%">
<!-- 			onsubmit="document.getElementById('login_form').action='j_security_check';" -->
			<h:form id="login_form">
				<p:panelGrid >
<!-- 						<input type="text" name="j_username" size="13" /> -->
<!-- 						<input type="password" name="j_password" size="13"/> -->

					<p:inputText  id="username" value="#{userSessionMB.username}" size="15"
						placeholder="#{text['label_username']}" required="true"							
						validatorMessage="#{text['msg_invalid_username_length']}"  />

					<p:password id="password" value="#{userSessionMB.password}" size="15"
						placeholder="#{text['label_password']}" required="true" 							
						validatorMessage="#{text['msg_invalid_password_format']}" />
					
					<p:commandButton value="#{text['label_login']}" ajax="false"  
						action="#{userSessionMB.jaasLogin()}" process="@form" />
				</p:panelGrid>
			</h:form>
		</p:layoutUnit>

		<p:layoutUnit position="center" header="#{text['label_create_an_account']}" >
			
			<p:growl id="growl" showDetail="true" sticky="true" />
			
			<h:form id="register_form">
				<h:panelGrid columns="4" cellpadding="5">
					
					<h:outputLabel for="cpf" value="#{text['label_cpf']}" />
					<p:inputMask id="cpf" value="#{homeMB.user.generalInfo.cpf}" size="15"
						mask="999.999.999-99" required="true" label="#{text['label_cpf']}" >
						<f:validateLength for="cpf" minimum="14" maximum="14" />
					</p:inputMask>
					
					<h:outputLabel for="email" value="#{text['label_email']}" />
					<p:inputText id="email" value="#{homeMB.user.generalInfo.email}" size="15"
						required="true" label="#{text['label_email']}" />					
					
					<h:outputLabel for="firstName" value="#{text['label_first_name']}" />
					<p:inputText id="firstName" value="#{homeMB.user.generalInfo.firstName}" size="15"
						required="true" label="#{text['label_first_name']}" />

					<h:outputLabel for="lastName" value="#{text['label_last_name']}" />
					<p:inputText id="lastName" value="#{homeMB.user.generalInfo.lastName}" size="15"
						required="true" label="#{text['label_last_name']}" />
					
					<h:outputLabel for="birthdate" value="#{text['label_birthdate']}" />
					<p:calendar id="birthdate" value="#{homeMB.user.generalInfo.birthdate}" size="15"
						pattern="dd-MM-yyyy" mask="true" required="true" converter="localDateTimeConverter"
						label="#{text['label_birthdate']}" />				
					
					<h:outputLabel for="username" value="#{text['label_username']}" />
					<p:inputText id="username" value="#{homeMB.user.username}" size="15" 
						required="true" label="#{text['label_username']}"
						validatorMessage="#{text['msg_invalid_username_length']}" />
					
					<h:outputLabel for="password" value="#{text['label_password']}" />
					<p:password id="password" value="#{homeMB.user.password}" size="15"
						required="true" label="#{text['label_password']}" />
					
					<h:outputLabel for="role" value="#{text['label_role']}" />
					<h:selectOneMenu id="role" value="#{homeMB.selectedRole.id}" label="#{text['label_role']}">
			            <f:selectItems value="#{homeMB.allRoles()}" var="role" itemLabel="#{text['label_' += role.name]}" 
			            	itemValue="#{role.id}" />			            
			        </h:selectOneMenu>
			        
			        <h:outputLabel for="institute" value="#{text['label_institute']}" />
					<h:selectOneMenu id="institute" value="#{homeMB.institute.id}" label="#{text['label_institute']}">
						<p:ajax event="change" listener="#{homeMB.changeInstituteEvent()}" update=":register_form:course"/>						
			            <f:selectItems value="#{homeMB.institutes}" var="institute" itemLabel="#{institute.name}" 
			            	itemValue="#{institute.id}" />			            
			        </h:selectOneMenu>
			        
			        <h:outputLabel for="course" value="#{text['label_course']}" />
					<h:selectOneMenu id="course" value="#{homeMB.user.generalInfo.course.id}" label="#{text['label_course']}">
						<p:ajax event="change" listener="#{homeMB.changeCourseEvent()}" />
			            <f:selectItems value="#{homeMB.institute.courses}" var="course" itemLabel="#{course.name}" 
			            	itemValue="#{course.id}" />			            
			        </h:selectOneMenu>
			        
					<f:facet name="footer">
						<p:commandButton id="registerBtn" process="@form" ajax="false"
							value="#{text['label_register']}" action="#{homeMB.persistUser()}" />
					</f:facet>	
					<br />
				</h:panelGrid>
			</h:form>
		</p:layoutUnit>
		<p:layoutUnit position="south" footer="version 0.1 | Copyright 2017"
			style="text-align: center;" />
	</p:layout>
</h:body>
</html>
